language: java
jdk:
- oraclejdk8

install: true

cache:
  directories:
    - $HOME/.m2
    - $HOME/UI/node_modules

before_install:
# shutdown servies on Travis, which may have a memory impact
# show memory usage before and after shutdown of services
 - "sudo service --status-all"
 - "sudo free -m -t"
 - "sudo /etc/init.d/mysql stop"
 - "sudo /etc/init.d/postgresql stop"
 - "#sudo /etc/init.d/couchdb stop"
 - "sudo /etc/init.d/redis-server stop"
 - "sudo free -m -t"

script: mvn clean install -q

notifications:
  webhooks:
    urls:
      https://webhooks.gitter.im/e/48597b0f75dd571734bc
    on_success: always  # options: [always|never|change] default: always
    on_failure: always  # options: [always|never|change] default: always
    on_start: always   # options: [always|never|change] default: always
  email:
    recipients:
      - amit.mawkin@capitalone.com
      - tapabrata.pal@capitalone.com
    on_success: always #[always|never|change] # default: change
    on_failure: always # [always|never|change] # default: always

before_script:
 - "echo $JAVA_OPTS"
 - "export JAVA_OPTS=-Xmx512m"

after_failure:
# show memory usage again
 - "sudo free -m -t"
# show actions of the OOM killer
 - "sudo dmesg"

after_success:
  - codecov
branches:
  only:
  - master
  - gerrit-integration
